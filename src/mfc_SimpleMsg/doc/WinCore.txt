# 🏗️ 消息映射系统架构详解
## 消息处理优先级

消息到达 CWnd::WindowProc()
        ↓
┌─────────────────┐
│   OnWndMsg()    │ ← 主要消息分发器
└─────────────────┘
        ↓
├─ 命令消息 (WM_COMMAND) → OnCommand()
├─ 通知消息 (WM_NOTIFY)  → OnNotify()  
└─ 标准消息 → 消息映射表查找
        ↓
┌─────────────────┐
│ 消息映射表遍历  │ ← 从派生类到基类
└─────────────────┘
        ↓
├─ 找到处理函数 → 调用对应函数
└─ 未找到处理函数 → DefWindowProc()


## 消息映射表结构

AFX_MSGMAP 结构
├─ pBaseMap    → 基类的消息映射表
└─ pEntries    → 消息条目数组
     ├─ 条目1: {消息, 代码, ID范围, 函数指针, 签名}
     ├─ 条目2: {消息, 代码, ID范围, 函数指针, 签名}
     ├─ ...
     └─ 结束标记: {AfxSig_end}
	 
	 
	 
## 函数签名系统
AfxSig_vv  → void OnMessage()
AfxSig_vw  → void OnMessage(WPARAM)
AfxSig_is  → int OnMessage(LPTSTR)
AfxSig_lwl → LRESULT OnMessage(WPARAM, LPARAM)
... 更多签名支持不同的参数组合

这个完整的消息映射系统是 MFC 框架的核心，它实现了：
1. 类型安全的消息处理 - 通过函数签名确保参数类型正确

2. 继承链消息处理 - 支持从派生类到基类的消息传递

3. 高效的消息查找 - 使用编译时生成的静态表

4. 灵活的消息处理 - 支持命令、通知和标准消息的统一处理